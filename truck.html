<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>トラック燃費記録</title>
  <meta name="theme-color" content="#1e3a8a">
  <meta name="description" content="大型トラック燃費管理アプリ">
  <!-- ★ 相対パスを明示（レポジトリ名に依存しない） -->
  <link rel="manifest" href="./truck-manifest.webmanifest">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚛</text></svg>">
  <link rel="stylesheet" href="truck.css">
</head>
<body>
<header>
  <h1>🚛 トラック燃費記録</h1>
</header>

<div class="container">
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('input')">入力</button>
    <button class="tab-btn" onclick="switchTab('list')">履歴</button>
    <button class="tab-btn" onclick="switchTab('summary')">月次集計</button>
  </div>

  <!-- 入力 -->
  <div id="view-input" class="tab-content">
    <div id="fuel-preview-card">
      <div>今回の計算結果（プレビュー）</div>
      <div class="preview-value" id="preview-efficiency">-</div>
      <div class="preview-sub">
        走行: <span id="preview-distance">0</span> km /
        給油: <span id="preview-fuel">0</span> L
      </div>
    </div>

    <div class="log-card" style="border-left-color: var(--accent-color);">
      <form id="fuelForm">
        <div class="form-group">
          <label for="date">日付</label>
          <input type="date" id="date" required>
        </div>
        <div class="form-group">
          <label for="odometer">積算距離 (km)</label>
          <input type="number" id="odometer"
                 placeholder="例: 123456.7" step="0.1" inputmode="decimal" required>
          <small id="last-odometer-hint" class="hint"></small>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="fuelA">給油A (L)</label>
            <input type="number" id="fuelA" step="0.01"
                   placeholder="主タンク" inputmode="decimal">
          </div>
          <div class="form-group">
            <label for="fuelB">給油B (L)</label>
            <input type="number" id="fuelB" step="0.01"
                   placeholder="サブ" inputmode="decimal">
          </div>
        </div>
        <div class="form-group">
          <label for="memo">メモ</label>
          <textarea id="memo" rows="2"
                    placeholder="場所や荷物の状況など"></textarea>
        </div>
        <button type="submit" class="btn btn-main" id="submitButton">
          💾 記録を追加する
        </button>
      </form>
    </div>
  </div>

  <!-- 履歴 -->
  <div id="view-list" class="hidden tab-content">
    <button class="btn btn-toggle-import" onclick="toggleImportPanel()">
      📥 CSVインポート機能を開く
    </button>

    <div id="import-panel" class="import-section hidden">
      <div style="color:var(--import-color); font-weight:600; margin-bottom:0.3rem;">
        🚚 CSVインポート（ヘッダー自動判定）
      </div>
      <div>※1行目をヘッダーとして、日付・距離・給油量の列を自動で探します。</div>
      <input type="file" id="csvFile" accept=".csv">
      <button class="btn btn-import" onclick="importCSV()">📥 インポート実行</button>
      <div style="margin-top:0.3rem; color:#6b7280;">
        千区切り付き数値（例: 56,061.8）にも対応します。
      </div>
    </div>

    <div id="logs-container">
      <p style="text-align:center; color:#888; padding:1.5rem 0;">
        データを読み込み中…
      </p>
    </div>

    <button class="btn btn-export" onclick="exportCSV()">📤 CSVエクスポート</button>
    <button class="btn btn-full-danger" onclick="deleteAllLogs()">
      🗑️ 全データ削除
    </button>
  </div>

  <!-- 集計 -->
  <div id="view-summary" class="hidden tab-content">
    <div class="form-group">
      <label for="summaryMonth">表示年月</label>
      <input type="month" id="summaryMonth" onchange="renderSummary()">
    </div>
    <div id="summary-content">
      <p style="text-align:center; color:#888; padding:2rem 0;">
        年月を選んで集計してください。
      </p>
    </div>
  </div>
</div>

<div id="notification">保存しました</div>

<script src="truck.js"></script>
</body>
</html>
